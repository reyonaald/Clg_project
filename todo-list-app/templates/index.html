<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do List App</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>My To-Do List</h1>
        <p class="subtitle">✨ Organize your day with nature's calm ✨</p>
        
        <!-- Add Task Form -->
        <form method="POST" action="/add" class="add-form">
            <div class="input-group">
                <input 
                    type="text" 
                    name="task" 
                    placeholder="What would you like to accomplish today?" 
                    required
                    autofocus
                >
                <select name="priority" class="priority-select">
                    <option value="low">Low 🟢</option>
                    <option value="medium" selected>Medium 🟡</option>
                    <option value="high">High 🔴</option>
                </select>
                <input 
                    type="date" 
                    name="due_date" 
                    class="due-date-input"
                    title="Due date (optional)"
                >
                <button type="submit" class="btn-add">
                    <span>Add Task</span>
                </button>
            </div>
        </form>

        <!-- Filter Buttons -->
        <div class="filter-buttons">
            <a href="/" class="filter-btn {% if not filter_type %}active{% endif %}">All 📋</a>
            <a href="/filter/active" class="filter-btn {% if filter_type == 'active' %}active{% endif %}">Active ⏳</a>
            <a href="/filter/completed" class="filter-btn {% if filter_type == 'completed' %}active{% endif %}">Done ✅</a>
            <a href="/filter/high" class="filter-btn {% if filter_type == 'high' %}active{% endif %}">High 🔴</a>
            <a href="/filter/medium" class="filter-btn {% if filter_type == 'medium' %}active{% endif %}">Medium 🟡</a>
            <a href="/filter/low" class="filter-btn {% if filter_type == 'low' %}active{% endif %}">Low 🟢</a>
        </div>

        <!-- Task Statistics -->
        {% set total_tasks = tasks|length %}
        {% set completed_tasks = tasks|selectattr('completed', 'equalto', True)|list|length %}
        {% set pending_tasks = total_tasks - completed_tasks %}
        
        {% if total_tasks > 0 %}
        <div class="stats">
            <div class="stat-item">
                <span class="stat-number">{{ total_tasks }}</span>
                <span class="stat-label">Total</span>
            </div>
            <div class="stat-item">
                <span class="stat-number">{{ pending_tasks }}</span>
                <span class="stat-label">Pending</span>
            </div>
            <div class="stat-item">
                <span class="stat-number">{{ completed_tasks }}</span>
                <span class="stat-label">Done</span>
            </div>
        </div>
        {% endif %}

        <!-- Tasks List -->
        <div class="tasks-container">
            {% if tasks %}
                <ul class="task-list">
                    {% for task in tasks %}
                    <li class="task-item {% if task.completed %}completed{% endif %} priority-{{ task.get('priority', 'medium') }}">
                        <div class="task-content">
                            <form method="POST" action="/toggle/{{ task.id }}" class="toggle-form">
                                <button type="submit" class="checkbox" onclick="celebrateTask(event, {{ task.completed|lower }})">
                                    {% if task.completed %}
                                    <span class="checkmark">✓</span>
                                    {% endif %}
                                </button>
                            </form>
                            
                            <div class="task-text">
                                <span class="task-title">
                                    {% if task.get('priority') == 'high' %}
                                    <span class="priority-badge high">🔥</span>
                                    {% elif task.get('priority') == 'low' %}
                                    <span class="priority-badge low">🌱</span>
                                    {% else %}
                                    <span class="priority-badge medium">⭐</span>
                                    {% endif %}
                                    {{ task.text }}
                                </span>
                                <div class="task-meta">
                                    <span class="task-date">📅 {{ task.created_at }}</span>
                                    {% if task.get('due_date') %}
                                    <span class="due-date">⏰ Due: {{ task.due_date }}</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <form method="POST" action="/delete/{{ task.id }}" class="delete-form">
                            <button type="submit" class="btn-delete" title="Delete task">
                                🗑️
                            </button>
                        </form>
                    </li>
                    {% endfor %}
                </ul>

                {% if completed_tasks > 0 %}
                <form method="POST" action="/clear" class="clear-form">
                    <button type="submit" class="btn-clear">
                        Clear Completed Tasks ({{ completed_tasks }})
                    </button>
                </form>
                {% endif %}
            {% else %}
                <div class="empty-state">
                    <div class="empty-icon">🌱</div>
                    <h3>No tasks yet!</h3>
                    <p>Start your productive day by adding your first task above.</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Celebration Confetti Effect -->
    <div id="confetti-container"></div>

    <script>
        // Fun celebration effect when completing a task
        function celebrateTask(event, isAlreadyCompleted) {
            if (!isAlreadyCompleted) {
                // Create confetti effect
                const confettiContainer = document.getElementById('confetti-container');
                const colors = ['#8fbc8f', '#d4a574', '#7fb3d5', '#f5e6d3', '#e8d5c4'];
                
                for (let i = 0; i < 30; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 0.3 + 's';
                    confettiContainer.appendChild(confetti);
                    
                    // Remove confetti after animation
                    setTimeout(() => confetti.remove(), 2000);
                }
                
                // Play success sound (visual feedback)
                const checkbox = event.target.closest('.checkbox');
                checkbox.style.transform = 'scale(1.3)';
                setTimeout(() => {
                    checkbox.style.transform = 'scale(1)';
                }, 300);
            }
        }

        // Add shake animation to overdue tasks
        window.addEventListener('load', function() {
            const today = new Date().toISOString().split('T')[0];
            document.querySelectorAll('.due-date').forEach(function(elem) {
                const dueDate = elem.textContent.replace('⏰ Due: ', '');
                if (dueDate < today) {
                    elem.classList.add('overdue');
                    elem.closest('.task-item').classList.add('has-overdue');
                }
            });
        });
    </script>
</body>
</html>
